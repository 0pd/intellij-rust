# Getting started

## Clone

```
git clone --recursive https://github.com/intellij-rust/intellij-rust.git
cd intellij-rust
```

## Building

To build the plugin just navigate to the directory you've previously checked it out and type `./gradlew build`. That's it.

This creates a zip archive in `build/distributions` which you can install with the `Install plugin from disk...` action found in `Settings > Plugins`.

## Running

To launch the plugin from console just type `./gradlew runIdea`.


## Development

For development you could use any editor/IDE of your choice. There is no peculiar dependency on IDEA, though we're particularly stuck to it, therefore providing instructions how to nail it from that side.

If you're using any other particular stack feel free to contribute to that list.

* [IDEA](#IDEA)


### IDEA

For development you'd need IDEA with Kotlin plugin (which is shipped by default starting from 14.1)

You can get the latest Intellij IDEA Community Edition [here](https://www.jetbrains.com/idea/download/).
You can also get the version from EAP channel [here](https://confluence.jetbrains.com/display/IDEADEV/EAP).

To import the project just: `Ctrl + Shift + A`, `Import project` or `File`, `New`, `Project from existing
sources`, and select `build.gradle` from the root directory of the plugin.


# Contributing

To contribute to the code of the project check out the the latest version and follow instructions on how to build & run it.

If you feel yourself new to the field or don't know what you should start coping with check out issue-tracker for the
[up-for-grab](https://github.com/intellij-rust/intellij-rust/labels/up%20for%20grab) tasks as these may be greatest entry points to the project source code.

If you want to contribute to the project in any of the numerous other ways, first of all consider joining our [Gitter](https://gitter.im/alexeykudinkin/intellij-rust?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge) therefore
being on par with the current development efforts.

**NOTA BENE**

Please, make sure that all tests pass and Travis reports build as green prior to making a pull request.


## Code style

Please, consider our [code-style](STYLE.md) prior to submitting the pull request. We love PRs, but much more than just PRs we love PRs that are 'on style'.

For the Java sources we're stuck to the Google's [one](https://google.github.io/styleguide/javaguide.html).

## PR style

It's much easier to review small, focused pull requests. So if you can split your changes into several chunks then
please do it.


# Testing

It is much easier to understand code changes if they are accompanied with
tests. Test classes are placed in the `src/test/kotlin` directory, `src/test/resources` holds rust files
which are used as fixtures. We also include
[CTRS](https://github.com/brson/ctrs) as a submodule and use it to test the
parser.

The test suite can be run by launching:

    ./gradlew test

You can execute specific test from within IDE. To do so, navigate to the tests
and press `Ctrl+Shift+F10`. Note that IDEA test runner may not run gradle code
generation tasks, so if you are modifying `rust.bnf` or `RustLexer.flex`, you
may want to use the gradle runner instead.

# Plugin architecture

We use Kotlin language for the plugin. If you can program in Java or Rust, you
should be able to read/write Kotlin right away. Learn more about [Kotlin](https://kotlinlang.org/).

See the IDEA platform [documentation](http://www.jetbrains.org/intellij/sdk/docs/).
Of a particular interest are the following sections:
  * custom language
  [tutorial](http://www.jetbrains.org/intellij/sdk/docs/tutorials/custom_language_support_tutorial.html).
  * custom language support
  [reference](http://www.jetbrains.org/intellij/sdk/docs/reference_guide/custom_language_support.html)


It's also very inspirational to browse existing plugins. Check out
[Erlang](https://github.com/ignatov/intellij-erlang) and
[Go](https://github.com/go-lang-plugin-org/go-lang-idea-plugin) plugins.


The plugin is composed of three packages: `org.rust.lang`, `org.rust.ide` and `org.rust.cargo`.

The `lang` package is a heart of the plugin. It includes Rust Program Structure
Interface classes (PSI) which describe a contents of a Rust program. You can
think of PSI as an AST, but it is actually more general. AST is only one of
possible PSI backends. PSI classes are generated by Grammar Kit from `rust.bnf`
file and are extended via `lang.core.impl` package. The `lang` package is
responsible for the semantic analysis of PSI. `lang.resolve` package maps
variables and paths to their definitions, `lang.completion` package provides
semantic completion. Another important package in the `lang` is `stubs`.
It describes PsiStubs: another backend for PSI which is suited for
serialization and indexing.

The `cargo` package is used for integration with Cargo build tool. One part of
integration is to learn about the project structure from Cargo.
`CargoProjectResolver` is an entry point here. It invokes `cargo metadata`
command and stores the result as a number of IDEA modules and libraries.
Additional cargo specific information is persisted in
`cargo.project.module.persistence` package. Another part of integration is
running Cargo commands for building, running and testing. This is handled by `cargo.commands.Cargo`
class and `cargo.runconfig` package.

The `ide` package uses `cargo` and `lang` packages to provide a useful
functionality for the user. It consists of numerous rather sub packages. Some of
them are

* `intentions`: actions that the user can invoke with `Alt+Enter`,
* `inspections`: warnings and quick fixes,
* `navigation.goto`: leverages `lang.core.stubs.index` to provide GoToSymbol action.

# Adding new intentions and inspections.

Tests for intentions are similar and data driven: you specify `before.rs`,
`after.rs` and the name of the intention to invoke. So it makes sense to start
with the test.

Here is [an
example](https://github.com/intellij-rust/intellij-rust/blob/aa9db9c70e07a8175ef4fe043fd2438dd9788b26/src/test/kotlin/org/rust/ide/intentions/RustIntentionsTest.kt).
`dataPath` specifies path to the test files inside `src/test/resources`
directory. The names of the test files themselves are derived from the name of the test
function.

And here is the
[intention](https://github.com/intellij-rust/intellij-rust/blob/aa9db9c70e07a8175ef4fe043fd2438dd9788b26/src/main/kotlin/org/rust/ide/intentions/ExpandModule.kt)
itself. Don't forget to
[register](https://github.com/intellij-rust/intellij-rust/blob/aa9db9c70e07a8175ef4fe043fd2438dd9788b26/src/main/resources/META-INF/plugin.xml#L132-L135)
it in the `plugin.xml`.

Check [sdk docs](http://www.jetbrains.org/intellij/sdk/docs/index.html) for more information.